{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["export type FunctionSubstitute<F extends any[], T> = (...args: F) => (T & {\n  returns: (...args: T[]) => void;\n})\n\nexport type PropertySubstitute<T> = T & {\n  returns: (...args: T[]) => void;\n}\n\nexport type ObjectSubstitute<T extends Object> = {\n  [P in keyof T]:\n  T[P] extends (...args: infer F) => infer R ? FunctionSubstitute<F, R> :\n  PropertySubstitute<T[P]>;\n}\n\nexport class Substitute {\n  static for<T>(): ObjectSubstitute<T> {\n    let lastRecord: {\n      arguments: Array<any>,\n      shouldReturn: Array<any>,\n      currentReturnOffset: number,\n      proxy: any,\n      property: string|number\n    };\n\n    const createRecord = () => {\n      lastRecord = {\n        arguments: null,\n        shouldReturn: [],\n        proxy: null,\n        currentReturnOffset: 0,\n        property: null\n      };\n\n      return lastRecord;\n    };\n\n    const equals = (a: any, b: any) => {\n      if((!a || !b) && a !== b)\n        return false;\n\n      if(typeof a !== typeof b)\n        return false;\n\n      if(Array.isArray(a) !== Array.isArray(b))\n        return false;\n\n      if(Array.isArray(a) && Array.isArray(b)) {\n        if(a.length !== b.length)\n          return false;\n\n        for(let i=0;i<a.length;i++) {\n          if(!equals(a[i], b[i]))\n            return false;\n        }\n\n        return true;\n      }\n\n      return a === b;\n    }\n    \n    const createProxy = (r: any = null) => {\n      let localRecord: typeof lastRecord = r;\n      \n      let thisProxy: any;\n      return thisProxy = new Proxy(() => {}, {\n        apply: (_target, _thisArg, argumentsList) => {\n          if(localRecord.arguments) {\n            if(!equals(localRecord.arguments, argumentsList))\n              return void 0;\n\n            return localRecord.shouldReturn[localRecord.currentReturnOffset++];\n          }\n\n          localRecord.arguments = argumentsList;\n          return thisProxy;\n        },\n        get: (target, property) => {\n          if(typeof property === 'symbol') {\n            if(property === Symbol.toPrimitive)\n              return () => void 0;\n\n            return void 0;\n          }\n\n          if(property === 'valueOf')\n            return void 0;\n\n          if(property === 'toString')\n            return (target[property] || '').toString();\n\n          if(property === 'inspect')\n            return () => \"{SubstituteJS fake}\";\n\n          if(property === 'constructor')\n            return () => thisProxy;\n\n          if(property === 'returns')\n            return (...args: any[]) => localRecord.shouldReturn = args;\n\n          if(localRecord && localRecord.property === property) {\n            if(localRecord.arguments)\n              return thisProxy;\n\n            return localRecord.shouldReturn[localRecord.currentReturnOffset++];\n          }\n          \n          localRecord = createRecord();\n          localRecord.property = property;\n\n          return thisProxy;\n        }\n      });\n    };\n\n    return createProxy() as any;\n  }\n}"]}